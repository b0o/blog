{{ $scriptPath := .Get "path" }}
{{ $sourceCode := (.Page.Resources.Get $scriptPath).Content | safeJS }}
{{ $linesOfCode := len (findRE "\n" $sourceCode) }}

{{ $appRootId := md5 $sourceCode }}

{{ $reactAppPath := (printf "react-app-%s.html" $appRootId) }}
{{ $reactAppContext := (dict "SourceCode" $sourceCode "AppRootId" $appRootId "ReactVersion" (.Get "version")) }}
{{ $reactAppHtml := resources.Get "html/templates/react-app.html" | resources.ExecuteAsTemplate $reactAppPath $reactAppContext }}

{{ $maxLinesOfCode := 20 }}
{{ $tooMuchLinesOfCode := gt $linesOfCode $maxLinesOfCode }}


<div data-react-shortcode class="my-8 -mx-page-padding sm:mx-0">
  <div
    data-react-code-container
    style="--number-of-lines: {{ $maxLinesOfCode }};"
    class="sm:rounded-t-md"
    data-is-expanded="{{ cond $tooMuchLinesOfCode "false" "true" }}"
  >
    {{ partial "codeblock.html" (dict "Inner" $sourceCode "Type" "jsx" "Options" (.Get "hl_options")) }}
  </div>

  {{ if $tooMuchLinesOfCode }}
    <button
      data-react-show-more-code
      data-expanded-label="{{ i18n "ShowMore" }}"
      data-collapsed-label="{{ i18n "ShowLess" }}"
      class="flex w-full items-center justify-center border-t-2 border-b-2 border-divider bg-divider transition-colors duration-500 hover:bg-hover"
    >
      {{ i18n "ShowMore" }}
      {{ partial "svgs/chevron-down.svg" }}
    </button>
  {{ end }}


  <div
    data-react-iframe-container
    class="relative bg-[white] py-8 px-page-padding sm:mx-0 sm:rounded-b-md sm:shadow-md sm:shadow-shadow"
  >
    <button
      data-react-iframe-refresh
      aria-label="{{ i18n "RefreshApp" }}"
      class="btn btn-icon btn-icon-action btn-secondary absolute top-3 right-0 -translate-x-1/2 shadow-md shadow-shadow"
    >
      {{ partial "svgs/refresh-cw.svg" . }}
    </button>

    <iframe class="max-w-full" src="{{ $reactAppHtml.Permalink }}"> </iframe>
  </div>
</div>
