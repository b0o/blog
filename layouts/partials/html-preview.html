{{ $linesOfCode := len (findRE "\n" .SourceCode) }}
{{ $maxLinesOfCode := 20 }}
{{ $tooMuchLinesOfCode := gt $linesOfCode $maxLinesOfCode }}


<div data-html-preview class="my-8 -mx-horizontal-padding sm:mx-0">
  <div
    data-html-preview-codeblock-container
    data-max-lines-of-code="{{ $maxLinesOfCode }}"
    style="
      --lines-of-code: {{ $maxLinesOfCode }};
      --is-expanded: {{ cond $tooMuchLinesOfCode "0" "1" }};
      --vertical-padding: calc(var(--code-vertical-padding) * (var(--is-expanded) + 1));
      --max-height: calc(var(--code-line-height) * 1em * var(--lines-of-code) + var(--vertical-padding));
    "
    class="
      sm:rounded-t-md
      [&_pre]:max-h-[var(--max-height)]
      [&_pre]:rounded-b-none
      [&_[data-codeblock]]:my-0
    "
  >
    {{ partial "codeblock.html" (dict "Inner" .SourceCode "Type" .Language "Options" .HighlightOptions) }}
  </div>

  {{ if $tooMuchLinesOfCode }}
    <hr />

    <button
      data-html-expand-collapse-button
      class="btn btn-secondary flex w-full items-center justify-center rounded-none py-1"
    >
      <span data-text>
        {{ i18n "ShowMore" }}
      </span>

      {{ partial "svgs/chevron-down.svg" }}
    </button>
  {{ end }}


  <hr />

  {{ partial "html-preview-iframe.html" (dict "Resource" .IframeResource "Title" (.Title)) }}
</div>
