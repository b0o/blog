{{ $linesOfCode := len (findRE "\n" .SourceCode) }}
{{ $maxLinesOfCode := 20 }}
{{ $tooMuchLinesOfCode := gt $linesOfCode $maxLinesOfCode }}


<div data-html-preview class="full-width-on-mobile mt-16 mb-8">
  <div
    data-html-preview-codeblock-container
    data-is-collapsed="{{ cond $tooMuchLinesOfCode "true" "false" }}"
    style="
      --collapsed-height: calc(var(--code-line-height) * 1em * {{ $maxLinesOfCode }} + var(--code-vertical-padding));
    "
    class="
      [&_pre]:transition-duration-300
      [&_pre]:transition-ease
      group
      sm:rounded-t
      [&_pre]:rounded-b-none
      [&_pre]:transition-[max-height]
      [&[data-is-collapsed=true]_pre]:max-h-[var(--collapsed-height)]
      [&_[data-codeblock]]:my-0
    "
  >
    {{ partial "codeblock.html" (dict "Inner" .SourceCode "Type" .Language "Options" .HighlightOptions) }}


    <div class="rounded-b shadow shadow-shadow">
      {{ if $tooMuchLinesOfCode }}
        <hr />

        <button
          data-html-expand-collapse-button
          class="btn btn-secondary flex w-full items-center justify-center rounded-none py-1"
        >
          <span class="group-data-[is-collapsed=false]:hidden">
            {{ i18n "ShowMore" }}
          </span>

          <span class="group-data-[is-collapsed=true]:hidden">
            {{ i18n "ShowLess" }}
          </span>

          <span
            class="[&_svg]:ease [&_svg]:transition-transform [&_svg]:duration-300"
          >
            {{ partial "svgs/chevron-down.svg" }}
          </span>
        </button>
      {{ end }}


      <hr />

      {{ partial "html-preview-iframe.html" (dict "Resource" .IframeResource "Title" (.Title)) }}
    </div>
  </div>
</div>
