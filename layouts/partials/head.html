<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta
  name="description"
  content="{{ block "description" . }}
    {{ .Params.Description | default .Site.Params.Description }}
  {{ end }}"
/>
<meta name="deploy-date" content="{{ now.Format "2006-01-02" }}" />
<meta name="publish-date" content="{{ .Date.Format "2006-01-02" }}" />
<meta name="last-modified-date" content="{{ .Lastmod.Format "2006-01-02" }}" />
<meta name="author" content="{{ site.Author.name }}" />
<meta name="color-scheme" content="dark light" />

{{ define "partials/getTaxonomyTitle" }}
  {{- .Title -}}
{{ end }}

{{ with (.GetTerms "tags") }}
  {{ $tags := (apply . "partial" "getTaxonomyTitle" ".") }}
  {{ $tagsSeparatedByComma := (delimit $tags ", ") }}
  <meta name="keywords" content="{{ $tagsSeparatedByComma }}" />
{{ end }}

{{ with resources.GetRemote "https://fonts.googleapis.com/css2?family=Merriweather&family=Fira+Sans&display=swap" }}
  <style>
    {{ .Content | safeCSS }}
  </style>
{{ end }}

{{ $css := resources.Get "css/main.css" | postCSS }}
{{ if hugo.IsProduction }}
  {{ $css = $css | minify | resources.PostProcess }}
{{ else }}
  {{ $css = $css | resources.ExecuteAsTemplate (printf "styles.dev.%v.css" now.UnixMilli) . | resources.PostProcess }}
{{ end }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}" />

<title>
  {{ .Title }} |
  {{ .Site.Title }}
</title>

{{ if or .Params.math .Site.Params.math }}
  {{ partial "math.html" . }}
{{ end }}

{{ template "_internal/opengraph.html" . }}
{{ template "_internal/twitter_cards.html" . }}

{{ range .AlternativeOutputFormats -}}
  {{ if (and (eq .Name "RSS") hugo.IsProduction) }}
    {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
  {{ end }}
{{ end -}}

{{ if hugo.IsProduction }}
  <script
    async
    defer
    data-website-id="32b90065-c2a6-4390-9684-dfde99409815"
    src="https://umami-production-10b2.up.railway.app/main.js"
  ></script>
{{ end }}

{{ $themeButtonScript := resources.Get "js/theme-button.js" | js.Build }}
{{ $languageButtonScript := resources.Get "js/language-button.js" | js.Build }}
{{ $navScript := resources.Get "js/nav.js" | js.Build }}

{{ $bundle := slice $navScript $themeButtonScript $languageButtonScript | resources.Concat "js/bundle.js" }}

{{ if hugo.IsProduction }}
  {{ $bundle = $bundle | minify }}
{{ end }}


<script type="module" defer src="{{ $bundle.Permalink }}"></script>
