<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
{{ $description := cond .IsHome .Site.Params.Description (.Description | default .Summary) }}
<meta name="description" content="{{ $description }}" />
<meta name="deploy-date" content="{{ now.Format "2006-01-02" }}">
<meta name="publish-date" content="{{ .Date.Format "2006-01-02" }}">
<meta name="last-modified-date" content="{{ .Lastmod.Format "2006-01-02" }}">
<meta name="author" content="{{ site.Author.name }}">
<meta name="color-scheme" content="dark light">

{{ define "partials/getTaxonomyTitle" }}
  {{- .Title -}}
{{ end }}

{{ with (.GetTerms "tags") }}
  {{ $tags := (apply . "partial" "getTaxonomyTitle" ".") }}
  {{ $tagsSeparatedByComma := (delimit $tags ", ") }}
  <meta name="keywords" content="{{ $tagsSeparatedByComma }}">
{{ end }}

{{ $gravatarUrl := printf "https://www.gravatar.com/avatar/%s?s=384" (md5 .Site.Params.email) }}
<link rel="preload" as="image" href="{{ $gravatarUrl }}">

<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

{{ with resources.GetRemote "https://fonts.googleapis.com/css2?family=Merriweather&family=Fira+Sans&display=swap" }}
  <style>
    {{ .Content | safeCSS }}
  </style>
{{ end }}

{{ $css := resources.Get "css/main.css" | postCSS }}
{{ if hugo.IsProduction }}
  {{ $css = $css | minify | resources.PostProcess }}
{{ else }}
  {{ $css = $css | resources.ExecuteAsTemplate (printf "styles.dev.%v.css" now.UnixMilli) . | resources.PostProcess }}
{{ end }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}" />

{{ $darkSyntaxHighlight := resources.Get "css/dark-syntax-highlight.css" }}
{{ if hugo.IsProduction }}
  {{ $darkSyntaxHighlight = $darkSyntaxHighlight | minify }}
{{ end }}
<link rel="stylesheet" href="{{ $darkSyntaxHighlight.RelPermalink }}" />

<title>
  {{ .Title }} | {{ .Site.Title }}
</title>

{{ if or .Params.math .Site.Params.math }}
  {{ partial "math.html" . }}
{{ end }}

{{ template "_internal/opengraph.html" . }}
{{ template "_internal/twitter_cards.html" . }}

{{ range .AlternativeOutputFormats -}}
  {{ if (and (eq .Name "RSS") hugo.IsProduction) }}
    {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
  {{ end }}
{{ end -}}
