<!DOCTYPE html>
<html lang="{{ .Site.Params.htmlLang | default .Lang }}">
  <head>
    {{ partial "head.html" . }}

    {{ block "css" . }}
      {{ range (.Resources.Match "*.css") }}
        <link href="{{ .RelPermalink }}" rel="stylesheet" />
      {{ end }}
    {{ end }}
  </head>

  <body data-theme="light">
    <script>
      window.__setTheme = function(newTheme) {
        document.body.setAttribute("data-theme", newTheme);
        localStorage.setItem("__theme", newTheme);
        const oldTheme = newTheme === "dark" ? "light" : "dark"
        document
          .querySelector("link[href*='" + oldTheme + "']")
          .setAttribute("disabled", "");
        document
          .querySelector("link[href*='" + newTheme + "']")
          .removeAttribute("disabled");
        document.body.dispatchEvent("themeChange", { defail: { theme: newTheme }})
      }

      const storedTheme = localStorage.getItem("__theme");

      if (storedTheme) {
        window.__setTheme(storedTheme);
      } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        window.__setTheme("dark");
      }
    </script>

    {{ partial "header.html" . }}

    <main>
      {{ block "main" . }}
        {{ .Content }}
      {{ end }}
    </main>

    {{ partial "footer.html" . }}

    {{ block "scripts" . }}
      {{ range (.Resources.Match "*.js") }}
        <script src="{{ .RelPermalink }}"></script>
      {{ end }}
    {{ end }}

    {{ $themeScript := resources.Get "js/theme.js" }}
    {{ if .Site.IsServer }}
      <script src="{{ $themeScript.RelPermalink }}"></script>
    {{ else }}
      <script src="{{ ($themeScript | minify).RelPermalink }}"></script>
    {{ end }}
  </body>
</html>
