---
import Site from '@layouts/Site.astro'
import { useTranslate, getLanguageFromUrl, localizeUrl } from '@utils/i18n'
import _ from 'lodash'
import { getBlogPosts, getBlogPostTags } from '@utils/posts'
import Tag from '@components/Tag.astro'

export async function getStaticPaths() {
  const englishBlogPosts = await getBlogPosts('en')
  const portugueseBlogPosts = await getBlogPosts('pt')

  return [
    {
      params: { lang: undefined },
      props: {
        tags: getBlogPostTags(englishBlogPosts),
      },
    },
    {
      params: { lang: 'pt' },
      props: {
        tags: getBlogPostTags(portugueseBlogPosts),
      },
    },
  ]
}

const t = useTranslate(Astro)

// eslint-disable-next-line @typescript-eslint/no-unused-vars
type Props = {
  tags: string[]
}

const { tags } = Astro.props

const tagsByCount = _.countBy(tags)
---

<Site title="Tags" description={t('TagsDescription')}>
  <main class="grid grid-cols-layout my-8">
    <div>
      <h1 class="text-center mb-4 hidden sm:block">Tags</h1>

      <ul class="list-none m-0 flex flex-wrap gap-2">
        {
          _.uniq(tags)
            .sort((tagA, tagB) => {
              const countA = tagsByCount[tagA]
              const countB = tagsByCount[tagB]
              return countB - countA
            })
            .map((tag) => {
              const count = tagsByCount[tag]

              return (
                <li>
                  <Tag tag={tag} count={count} />
                </li>
              )
            })
        }
      </ul>
    </div>
  </main>
</Site>
